<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Simulate Survival and Recurrent Event Data with reda • reda</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">reda</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/reda-intro.html">Introduction to reda through Examples</a>
    </li>
    <li>
      <a href="../articles/reda-simulate.html">Simulate Survival and Recurrent Event Data with reda</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/wenjie2wang/reda">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Simulate Survival and Recurrent Event Data with reda</h1>
                        <h4 class="author">Wenjie Wang</h4>
            
            <h4 class="date">2017-11-29</h4>
          </div>

    
    
<div class="contents">
<p>In this vignette, we briefly introduce how to simulate survival and recurrent event data from stochastic process point of view with <strong>reda</strong> package. The core function named <code>simEvent</code> provides an intuitive and flexible interface for simulating survival and recurrent event times from one stochastic process. Another function named <code>simEventData</code> is simply a wrapper that calls <code>simEvent</code> internally and collects event times and covariates of a given number of processes into a data frame format. Examples of generating random samples from common survival and recurrent models are provided. The details of function syntax and the objects produced are available in the package manual and thus not covered in this vignette.</p>
<section id="intro" class="level2"><h2>Introduction</h2>
<section id="intensity" class="level3"><h3>Intensity function</h3>
<p>We first introduce the general form of hazard rate function considered and implemented in the function <code>simEvent</code>.</p>
<p>Consider <span class="math inline">\(n\)</span> stochastic processes with the baseline hazard rate function <span class="math inline">\(\rho(t)\)</span> of time <span class="math inline">\(t\)</span>. For the stochastic process <span class="math inline">\(i\)</span>, <span class="math inline">\(i\in\{1,\ldots,n\}\)</span>, let <span class="math inline">\(\mathbf{z}_i=(z_{i1},\ldots,z_{ip})^{\top}\)</span> denote the covariate vector of length <span class="math inline">\(p\)</span>, and <span class="math inline">\(\boldsymbol{\beta}=(\beta_1,\ldots,\beta_p)^{\top}\)</span> denote the covariate coefficients. We may incorporate the covariates and their coefficients into the stochastic process by specifying the intensity as a function of time <span class="math inline">\(t\)</span> and the covariates <span class="math inline">\(\mathbf{z}_i\)</span> as follows: <span class="math display">\[\lambda(t
\mid \mathbf{z}_i) = \rho(t)\,r(\mathbf{z}_i, \boldsymbol{\beta}),\]</span> where <span class="math inline">\(r(\mathbf{z}_i, \boldsymbol{\beta})\)</span> is the relative risk function. For the regular Cox model <span class="citation" data-cites="cox1972jrssb">(Cox 1972)</span> or the Andersen-Gill model <span class="citation" data-cites="andersen1982aos">(Andersen and Gill 1982)</span>, <span class="math inline">\(r(\mathbf{z}_i, \boldsymbol{\beta})= \exp\{\boldsymbol{\beta}^{\top}\mathbf{z}_i\}\)</span>. Other common choices include the linear relative risk model: <span class="math inline">\(r(\mathbf{z}_i, \boldsymbol{\beta}) = 1 + \boldsymbol{\beta}^{\top}\mathbf{z}_i\)</span>, and the excess relative risk model: <span class="math inline">\(r(\mathbf{z}_i, \boldsymbol{\beta}) = \prod_{j=1}^p(1 + \beta_j z_{ij})\)</span>.</p>
<p>We may extend the model by considering a random frailty effect <span class="math inline">\(w_i\)</span> (with expectation one) to account for heterogeneity between different processes or processes from different clusters. The intensity function becomes <span class="math display">\[\lambda(t
\mid \mathbf{z}_i, w_i) = \rho(t)\,r(\mathbf{z}_i, \boldsymbol{\beta})\,w_i.\]</span> The common choices for distribution of the random frailty effect include Gamma distribution of mean one, and lognormal distribution of mean zero in logarithm scale.</p>
<p>Furthermore, both covariates and coefficients may be time-varying. So the general form of the intensity function is given as follows: <span class="math display">\[\lambda\bigl(t
\mid \mathbf{z}_i(t), w_i\bigr) = \rho(t)\,r\bigl(\mathbf{z}_i(t),
\boldsymbol{\beta}(t)\bigr)\,w_i.\]</span></p>
</section><section id="sampling-methods" class="level3"><h3>Sampling methods</h3>
<p>The thinning method <span class="citation" data-cites="lewis1979nrlq">(Lewis and Shedler 1979)</span></p>
</section></section><section id="getting-started" class="level2"><h2>Getting started</h2>
<pre class="sourceCode r" id="cb1"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw">library</span>(reda)                    <span class="co"># attach reda package to the search path</span></a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="kw">packageVersion</span>(<span class="st">"reda"</span>)           <span class="co"># check the package version</span></a></code></pre>
<pre><code>## [1] '0.4.0.9000'</code></pre>
<pre class="sourceCode r" id="cb3"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="kw">options</span>(<span class="dt">digits =</span> <span class="dv">3</span>)              <span class="co"># set the number of significant digits to print</span></a>
<a class="sourceLine" id="cb3-2" data-line-number="2"><span class="kw">set.seed</span>(<span class="dv">123</span>)                    <span class="co"># set random number seed</span></a></code></pre>
</section><section id="poisson-process" class="level2"><h2>Poisson process</h2>
<section id="hpp" class="level3"><h3>Homogeneous Poisson process</h3>
<p>A homogeneous Poisson process (HPP) has a constant hazard rate over time and the interarrival times between two successive arrivals/events following exponential distribution. Two simple examples of simulating a homogeneous Poisson process using <code>simEvent</code> are given as follows:</p>
<pre class="sourceCode r" id="cb4"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1">## HPP from time 1 to 5 of intensity 1 without covariates</a>
<a class="sourceLine" id="cb4-2" data-line-number="2"><span class="kw"><a href="../reference/simEvent.html">simEvent</a></span>(<span class="dt">rho =</span> <span class="dv">1</span>, <span class="dt">origin =</span> <span class="dv">1</span>, <span class="dt">endTime =</span> <span class="dv">5</span>)</a></code></pre>
<pre><code>## 'simEvent' S4 class object:
## [1] 1.84 2.42 3.75 3.78 3.84 4.15 4.47 4.61</code></pre>
<pre class="sourceCode r" id="cb6"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1">## HPP from 0 to 10 of baseline rate 0.5 with two covariates</a>
<a class="sourceLine" id="cb6-2" data-line-number="2"><span class="kw"><a href="../reference/simEvent.html">simEvent</a></span>(<span class="dt">z =</span> <span class="kw">c</span>(<span class="fl">0.2</span>, <span class="fl">0.5</span>), <span class="dt">zCoef =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="op">-</span><span class="st"> </span><span class="fl">0.5</span>), <span class="dt">rho =</span> <span class="fl">0.5</span>, <span class="dt">endTime =</span> <span class="dv">10</span>)</a></code></pre>
<pre><code>## 'simEvent' S4 class object:
## [1] 2.84 5.68 8.13</code></pre>
<p>The function <code>simEventData</code> enable us to simulate multiple processes and collect the simulated event times into a survival or recurrent event data format.</p>
<pre class="sourceCode r" id="cb8"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1">## recurrent events from two processes with same covariates</a>
<a class="sourceLine" id="cb8-2" data-line-number="2"><span class="kw"><a href="../reference/simEvent.html">simEventData</a></span>(<span class="dv">2</span>, <span class="dt">z =</span> <span class="kw">c</span>(<span class="fl">0.2</span>, <span class="fl">0.5</span>), <span class="dt">zCoef =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="op">-</span><span class="st"> </span><span class="fl">0.5</span>), <span class="dt">rho =</span> <span class="fl">0.01</span>, <span class="dt">endTime =</span> <span class="dv">5</span>)</a></code></pre>
<pre><code>##   ID time event origin X.1 X.2
## 1  1    5     0      0 0.2 0.5
## 2  2    5     0      0 0.2 0.5</code></pre>
<p>In the example given above, the number of process is explicitly specified to be two. However, if it is not specified, it will be the number of rows of the covariate matrix. See the example given below.</p>
<pre class="sourceCode r" id="cb10"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1">## recurrent events from two processes</a>
<a class="sourceLine" id="cb10-2" data-line-number="2">## with different time-invariant covariate and time origin</a>
<a class="sourceLine" id="cb10-3" data-line-number="3"><span class="kw"><a href="../reference/simEvent.html">simEventData</a></span>(<span class="dt">z =</span> <span class="kw">cbind</span>(<span class="kw">rnorm</span>(<span class="dv">2</span>), <span class="fl">0.5</span>), <span class="dt">zCoef =</span> <span class="kw">c</span>(<span class="fl">0.2</span>, <span class="op">-</span><span class="st"> </span><span class="fl">0.5</span>),</a>
<a class="sourceLine" id="cb10-4" data-line-number="4">             <span class="dt">rho =</span> <span class="fl">0.01</span>, <span class="dt">origin =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">3</span>), <span class="dt">endTime =</span> <span class="kw">c</span>(<span class="dv">8</span>, <span class="dv">9</span>))</a></code></pre>
<pre><code>##   ID time event origin    X.1 X.2
## 1  1    8     0      1  0.800 0.5
## 2  2    9     0      3 -0.164 0.5</code></pre>
<p>We can also simulate survival data by taking the first event of each process. Setting <code>recurrent = FALSE</code> in function <code>simEvent</code> (or function <code>simEventData</code>) gives us the survival time(s) or the right censoring time(s). In the example given below, we specified <code>endTime = "rnorm"</code> and <code>arguments = list(endTime = list(mean = 4))</code> for generating a random censoring times from normal distribution with mean 4 and unit standard deviation.</p>
<pre class="sourceCode r" id="cb12"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1">## survival data by set 'recurrent = FALSE'</a>
<a class="sourceLine" id="cb12-2" data-line-number="2"><span class="kw"><a href="../reference/simEvent.html">simEventData</a></span>(<span class="dt">z =</span> <span class="kw">cbind</span>(<span class="kw">rnorm</span>(<span class="dv">10</span>), <span class="dv">1</span>), <span class="dt">zCoef =</span> <span class="kw">c</span>(<span class="fl">0.2</span>, <span class="op">-</span><span class="st"> </span><span class="dv">1</span>), <span class="dt">rho =</span> <span class="fl">0.1</span>,</a>
<a class="sourceLine" id="cb12-3" data-line-number="3">             <span class="dt">origin =</span> <span class="kw">c</span>(<span class="dv">0</span>, <span class="dv">1</span>), <span class="dt">endTime =</span> <span class="st">"rnorm"</span>, <span class="dt">recurrent =</span> <span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb12-4" data-line-number="4">             <span class="dt">arguments =</span> <span class="kw">list</span>(<span class="dt">endTime =</span> <span class="kw">list</span>(<span class="dt">mean =</span> <span class="dv">4</span>)))</a></code></pre>
<pre><code>##    ID time event origin     X.1 X.2
## 1   1 2.48     1      0  0.3937   1
## 2   2 5.69     0      1  0.4036   1
## 3   3 4.38     0      0 -0.8864   1
## 4   4 3.23     0      1 -1.3189   1
## 5   5 4.50     0      0  0.0288   1
## 6   6 4.05     0      1 -0.4321   1
## 7   7 4.79     0      0  1.6899   1
## 8   8 1.69     0      1  1.2284   1
## 9   9 3.26     0      0  0.2760   1
## 10 10 3.31     0      1 -1.0490   1</code></pre>
</section><section id="nhpp" class="level3"><h3>Nonhomogeneous Poisson process</h3>
<pre class="sourceCode r" id="cb14"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1">rhoFun &lt;-<span class="st"> </span><span class="cf">function</span>(x, <span class="dt">b =</span> <span class="dv">1</span>) (<span class="kw">sin</span>(x) <span class="op">+</span><span class="st"> </span><span class="dv">1</span>) <span class="op">*</span><span class="st"> </span>b</a>
<a class="sourceLine" id="cb14-2" data-line-number="2"><span class="kw"><a href="../reference/simEvent.html">simEvent</a></span>(<span class="dt">rho =</span> rhoFun, <span class="dt">endTime =</span> <span class="dv">5</span>)</a></code></pre>
<pre><code>## 'simEvent' S4 class object:
## [1] 0.732 1.500 1.503 2.057 2.207</code></pre>
<pre class="sourceCode r" id="cb16"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1"><span class="kw"><a href="../reference/simEvent.html">simEvent</a></span>(<span class="dt">z =</span> <span class="kw">rnorm</span>(<span class="dv">3</span>), <span class="dt">zCoef =</span> <span class="kw">rep</span>(<span class="fl">0.1</span>, <span class="dv">3</span>), <span class="dt">rho =</span> <span class="st">"rhoFun"</span>, <span class="dt">endTime =</span> <span class="dv">5</span>)</a></code></pre>
<pre><code>## 'simEvent' S4 class object:
## [1] 0.892 1.006 1.409 1.601 2.152 2.229 2.928 3.172</code></pre>
<pre class="sourceCode r" id="cb18"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" data-line-number="1"><span class="kw"><a href="../reference/simEvent.html">simEventData</a></span>(<span class="dt">z =</span> <span class="kw">cbind</span>(<span class="kw">rnorm</span>(<span class="dv">2</span>), <span class="fl">0.1</span>), <span class="dt">zCoef =</span> <span class="kw">rep</span>(<span class="fl">0.1</span>, <span class="dv">2</span>),</a>
<a class="sourceLine" id="cb18-2" data-line-number="2">             <span class="dt">rho =</span> <span class="st">"rhoFun"</span>, <span class="dt">origin =</span> <span class="st">"rnorm"</span>, <span class="dt">endTime =</span> <span class="st">"rnorm"</span>,</a>
<a class="sourceLine" id="cb18-3" data-line-number="3">             <span class="dt">arguments =</span> <span class="kw">list</span>(<span class="dt">rho =</span> <span class="kw">list</span>(<span class="dt">b =</span> <span class="fl">0.5</span>),</a>
<a class="sourceLine" id="cb18-4" data-line-number="4">                              <span class="dt">origin =</span> <span class="kw">list</span>(<span class="dt">mean =</span> <span class="dv">1</span>, <span class="dt">sd =</span> <span class="fl">0.1</span>),</a>
<a class="sourceLine" id="cb18-5" data-line-number="5">                              <span class="dt">endTime =</span> <span class="kw">list</span>(<span class="dt">mean =</span> <span class="dv">5</span>, <span class="dt">sd =</span> <span class="fl">0.5</span>)))</a></code></pre>
<pre><code>##   ID time event origin     X.1 X.2
## 1  1 2.64     1  0.926 -0.0341 0.1
## 2  1 3.10     1  0.926 -0.0341 0.1
## 3  1 4.45     0  0.926 -0.0341 0.1
## 4  2 3.09     1  1.009  2.1285 0.1
## 5  2 4.55     0  1.009  2.1285 0.1</code></pre>
</section></section><section id="renewal-processes" class="level2"><h2>Other renewal processes</h2>
</section><section id="beyond-time-invariant" class="level2"><h2>Beyond time-invariant</h2>
<section id="timevarying-covariates" class="level3"><h3>Timevarying covariates</h3>
</section><section id="timevarying-covariate-coefficients" class="level3"><h3>Timevarying covariate coefficients</h3>
</section></section><section id="frailty" class="level2"><h2>Frailty models</h2>
<section id="individual-frailty" class="level3"><h3>Frailty for individual process</h3>
</section><section id="shared-frailty" class="level3"><h3>Shared frailty for clusters</h3>
</section></section><section id="common-dist" class="level2"><h2>Examples for common survival models</h2>
</section><section id="multiple-event" class="level2"><h2>Extension to multiple event data</h2>
</section><section id="reference" class="level2 unnumbered"><h2>Reference</h2>
<div id="refs" class="references">
<div id="ref-andersen1982aos">
<p>Andersen, Per Kragh, and Richard David Gill. 1982. “Cox’s Regression Model for Counting Processes: A Large Sample Study.” <em>The Annals of Statistics</em> 10 (4). JSTOR:1100–1120.</p>
</div>
<div id="ref-cox1972jrssb">
<p>Cox, David R. 1972. “Regression Models and Life-Tables.” <em>Journal of the Royal Statistical Society. Series B (Methodological)</em> 34 (2). JSTOR:187–220.</p>
</div>
<div id="ref-lewis1979nrlq">
<p>Lewis, P A, and G S Shedler. 1979. “Simulation of Nonhomogeneous Poisson Processes by Thinning.” <em>Naval Research Logistics Quarterly</em> 26 (3). Wiley Online Library:403–13.</p>
</div>
</div>
</section>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#intro">Introduction</a></li>
      <li><a href="#getting-started">Getting started</a></li>
      <li><a href="#poisson-process">Poisson process</a></li>
      <li><a href="#renewal-processes">Other renewal processes</a></li>
      <li><a href="#beyond-time-invariant">Beyond time-invariant</a></li>
      <li><a href="#frailty">Frailty models</a></li>
      <li><a href="#common-dist">Examples for common survival models</a></li>
      <li><a href="#multiple-event">Extension to multiple event data</a></li>
      <li><a href="#reference">Reference</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Wenjie Wang, Haoda Fu.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
